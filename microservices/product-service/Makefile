# Variables
APP_NAME=product-service
VERSION=0.0.1-SNAPSHOT
REGISTRY=ibrahimlboss
IMAGE_NAME=$(REGISTRY)/$(APP_NAME)
JAR_FILE=target/$(APP_NAME)-$(VERSION).jar

# Default target
all: build jar docker run

# 1ï¸âƒ£ Build the project (Maven)
build:
	@echo "ğŸ”¨ Building the Java project..."
	JAVA_HOME="/c/Program Files/Java/jdk-21" ./mvnw clean package -DskipTests

# 2ï¸âƒ£ Build JAR (already done by Maven build)
jar:
	@echo "ğŸ“¦ JAR file generated at $(JAR_FILE)"
	@ls -lh $(JAR_FILE)

# 3ï¸âƒ£ Build Docker image
docker:
	@echo "ğŸ³ Building Docker image..."
	docker build -t $(IMAGE_NAME):latest .

# Run Docker container
run:
	@echo "ğŸš€ Running Docker container..."
	docker run -d --name $(APP_NAME) -p 8082:8082 $(IMAGE_NAME):latest	

# 4ï¸âƒ£ Push Docker image (optional)
push:
	@echo "ğŸš€ Pushing Docker image..."
	docker push $(IMAGE_NAME):latest

# 5ï¸âƒ£ Clean
clean:
	@echo "ğŸ§¹ Cleaning..."
	./mvnw clean
	docker rmi $(IMAGE_NAME):latest || true

# Stop Docker container
stop:
	@echo "ğŸ›‘ Stopping Docker container..."
	docker stop $(APP_NAME) || true
# Run the docker-compose
run-compose:
	@echo "ğŸš€ Running docker-compose..."
	docker-compose up -d	


