# ==========================
# List of services
# ==========================
SERVICES=auth-service gateway-service product-service order-service file-service

# ==========================
# Default target
# ==========================
.PHONY: all
all: build up

# ==========================
# 1Ô∏è‚É£ Build JARs for all services using their own Makefiles
# ==========================
.PHONY: build
build:
	@echo "üî® Building all Spring Boot services..."
	@for service in $(SERVICES); do \
		echo "‚û° Building $$service..."; \
		cd $$service && make build && cd ..; \
	done

# ==========================
# 2Ô∏è‚É£ Build Docker images for all services
# ==========================
.PHONY: docker-build
docker-build:
	@echo "üê≥ Building Docker images..."
	@for service in $(SERVICES); do \
		echo "‚û° Building image for $$service..."; \
		docker build -t ibrahimlboss/$$service:latest $$service; \
	done

# ==========================
# 3Ô∏è‚É£ Start Docker Compose stack
# ==========================
.PHONY: up
up:
	@echo "üöÄ Starting Docker Compose..."
	docker compose up --build -d

# ==========================
# 4Ô∏è‚É£ Stop Docker Compose stack
# ==========================
.PHONY: down
down:
	@echo "üõë Stopping Docker Compose..."
	docker compose down

# ==========================
# 5Ô∏è‚É£ Push Docker images to Docker Hub
# ==========================
.PHONY: docker-push
docker-push:
	@echo "üì§ Pushing Docker images..."
	@for service in $(SERVICES); do \
		echo "‚û° Pushing image for $$service..."; \
		docker push ibrahimlboss/$$service:latest; \
	done
