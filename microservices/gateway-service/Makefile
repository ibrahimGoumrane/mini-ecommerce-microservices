# Variables
APP_NAME=gateway-service
VERSION=0.0.1-SNAPSHOT
REGISTRY_URL=ibrahimlboss
IMAGE_NAME=$(REGISTRY_URL)/$(APP_NAME)
JAR_FILE=target/$(APP_NAME)-$(VERSION).jar

# Default target
all: build jar docker

# 1ï¸âƒ£ Build the project (Maven)
build:
	@echo "ğŸ”¨ Building the Java project..."
	JAVA_HOME="/c/Program Files/Java/jdk-21" ./mvnw clean package -DskipTests

# 2ï¸âƒ£ Build JAR (already done by Maven build)
jar:
	@echo "ğŸ“¦ JAR file generated at $(JAR_FILE)"
	@ls -lh $(JAR_FILE)

# 3ï¸âƒ£ Build Docker image
docker:
	@echo "ğŸ³ Building Docker image..."
	docker build -t $(IMAGE_NAME):latest .

# 4ï¸âƒ£ Push Docker image (optional)
push:
	@echo "ğŸš€ Pushing Docker image..."
	docker push $(IMAGE_NAME):latest

# 5ï¸âƒ£ Clean
clean:
	@echo "ğŸ§¹ Cleaning..."
	./mvnw clean
	docker rmi $(IMAGE_NAME):latest || true